name: Release

on:
  push:
    branches: ["main"]

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    env:
      TAG: v${{ github.run_number }}
      ZIP: FuldFokus-v${{ github.run_number }}.zip
    steps:
      - uses: actions/checkout@v4

      - name: Build zip
        run: |
          mkdir -p dist/FuldFokus
          cp -r Emotes dist/FuldFokus/
          cp -r UI dist/FuldFokus/
          cp FuldFokus.lua dist/FuldFokus/
          cp FuldFokus.toc dist/FuldFokus/
          cp FFE_Details.lua dist/FuldFokus/
          cp FFE_Commands.lua dist/FuldFokus/
          cp FFE_Options.lua dist/FuldFokus/
          cd dist 
          zip -r "$ZIP" FuldFokus

      - name: Create Git tag
        run: |
          git tag $TAG
          git push origin $TAG

      - name: Create GitHub release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.TAG }}
          name: ${{ env.TAG }}
          files: dist/${{ env.ZIP }}
          generate_release_notes: true